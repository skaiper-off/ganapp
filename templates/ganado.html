{% extends "base.html" %}

{% block title %}Gesti√≥n de Ganado{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>üêÑ Gesti√≥n de Ganado</h2>
    </div>

    <!-- Formulario de Registro -->
    <h3 class="card-title">‚ûï Registrar Nuevo Ganado</h3>
    
    <form method="POST" action="{{ url_for('registrar_ganado') }}">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            <div class="form-group">
                <label class="form-label">N√∫mero de Arete *</label>
                <input type="text" name="arete" class="form-control" required>
            </div>

            <div class="form-group">
                <label class="form-label">Nombre</label>
                <input type="text" name="nombre" class="form-control">
            </div>

            <div class="form-group">
                <label class="form-label">Sexo</label>
                <select name="sexo" class="form-control">
                    <option value="Macho">Macho</option>
                    <option value="Hembra">Hembra</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Fecha de Nacimiento</label>
                <input type="date" name="fecha" class="form-control" value="{{ today }}">
            </div>

            <div class="form-group">
                <label class="form-label">Estado</label>
                <select name="estado" class="form-control">
                    <option value="Vivo">Vivo</option>
                    <option value="Muerto">Muerto</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">Observaciones</label>
            <textarea name="observaciones" class="form-control"></textarea>
        </div>

        <button type="submit" class="btn btn-success">‚úÖ Registrar Ganado</button>
    </form>
</div>

<!-- Listado de Ganado -->
<div class="card">
    <h3 class="card-title">üìä Listado de Ganado ({{ ganado|length }} animales)</h3>

    <!-- Barra de b√∫squeda -->
    <form method="GET" action="{{ url_for('listar_ganado') }}" class="search-bar">
        <input type="text" name="buscar" class="form-control" 
               placeholder="üîç Buscar por arete o nombre..." 
               value="{{ busqueda }}">
        <button type="submit" class="btn btn-primary">Buscar</button>
        {% if busqueda %}
        <a href="{{ url_for('listar_ganado') }}" class="btn btn-warning">Limpiar</a>
        {% endif %}
    </form>

    <!-- Tabla -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Arete</th>
                    <th>Nombre</th>
                    <th>Sexo</th>
                    <th>Fecha Nacimiento</th>
                    <th>Estado</th>
                    <th>Observaciones</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for animal in ganado %}
                <tr class="{% if animal[4] and animal[4].lower() == 'vivo' %}row-vivo{% else %}row-muerto{% endif %}">
                    <td><strong>{{ animal[0] }}</strong></td>
                    <td>{{ animal[1] or '-' }}</td>
                    <td>{{ animal[2] }}</td>
                    <td>{{ animal[3] }}</td>
                    <td>
                        {% if animal[4] and animal[4].lower() == 'vivo' %}
                            <span style="color: var(--success); font-weight: bold;">‚úÖ Vivo</span>
                        {% else %}
                            <span style="color: var(--danger); font-weight: bold;">‚ùå Muerto</span>
                        {% endif %}
                    </td>
                    <td>{{ animal[5] or '-' }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('eliminar_ganado') }}" 
                              style="display: inline;"
                              onsubmit="return confirm('¬øEst√°s seguro de eliminar el ganado {{ animal[0] }}?');">
                            <input type="hidden" name="arete" value="{{ animal[0] }}">
                            <button type="submit" class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                                üóëÔ∏è Eliminar
                            </button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: 2rem; color: var(--dark);">
                        {% if busqueda %}
                            ‚ùå No se encontraron resultados para "{{ busqueda }}"
                        {% else %}
                            üì≠ No hay ganado registrado a√∫n
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}